<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ‘¶ ìš°ë¦¬ ì•„ê¸° ë§ì´ ì¤€ë¹„ë¬¼ (V15)</title>
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        :root {
            --main-color: #FF878D;
            --sub-color: #FFF0F5;
            --bg-color: #F7F8FA;
            --text-color: #333;
            --price-color: #FF6B6B;
            --carrot-color: #FF8A3D;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Pretendard', sans-serif; background-color: var(--bg-color); margin: 0; padding: 0; color: var(--text-color); }
        .container { max-width: 600px; margin: 0 auto; padding-bottom: 150px; }

        /* í—¤ë” */
        .header { background: linear-gradient(120deg, #ff9a9e 0%, #fecfef 100%); padding: 20px 20px 25px; color: white; border-radius: 0 0 25px 25px; box-shadow: 0 4px 20px rgba(255, 154, 158, 0.3); }
        .header-top-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .header h2 { margin: 0; font-size: 20px; font-weight: 800; }
        
        .edit-toggle-wrap { display: flex; align-items: center; gap: 8px; font-size: 13px; font-weight: 600; }
        .switch { position: relative; display: inline-block; width: 44px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(255,255,255,0.4); transition: .4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: rgba(255,255,255,0.95); }
        input:checked + .slider:before { transform: translateX(20px); background-color: var(--main-color); }

        .total-budget-badge { background: rgba(255,255,255,0.95); color: var(--main-color); padding: 6px 12px; border-radius: 15px; font-weight: bold; font-size: 13px; display: inline-block; }
        .progress-box { background: rgba(255,255,255,0.25); backdrop-filter: blur(5px); padding: 15px; border-radius: 12px; display: flex; align-items: center; justify-content: space-between; margin-top: 10px; }
        .progress-circle { width: 45px; height: 45px; border-radius: 50%; background: white; color: var(--main-color); display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 13px; }
        .progress-bar-bg { flex: 1; height: 6px; background: rgba(255,255,255,0.5); border-radius: 4px; margin: 0 15px; overflow: hidden; }
        .progress-bar { height: 100%; background: white; width: 0%; transition: width 0.5s ease; }
        .total-info { font-size: 12px; font-weight: 600; text-align: right;}

        /* ì¹´í…Œê³ ë¦¬ & ì•„ì´í…œ */
        .category-card { background: white; margin: 20px; border-radius: 16px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); overflow: hidden; position: relative; }
        .category-card.sortable-ghost { opacity: 0.4; background: #eee; }
        
        .cat-header { padding: 15px 20px; background: #fff; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; }
        .cat-left { display: flex; align-items: center; gap: 10px; }
        .drag-handle-cat { display: none; color: var(--main-color); font-size: 22px; cursor: grab; margin-right: 5px; font-weight: bold; }
        
        .cat-icon { font-size: 18px; background: var(--sub-color); width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; }
        .cat-title { font-size: 16px; font-weight: 700; }
        .cat-sum { font-size: 12px; color: #888; font-weight: 500; margin-left: 5px; }
        
        .cat-actions { display: flex; gap: 5px; align-items: center; }
        .btn-edit-cat, .btn-delete-cat { font-size: 16px; cursor: pointer; padding: 5px; display: none; color: #aaa; }
        .btn-delete-cat { color: #ff6b6b; }

        .item-list { list-style: none; padding: 0; margin: 0; min-height: 10px; }
        .item { padding: 15px 20px; border-bottom: 1px solid #f9f9f9; background: white; }
        .item.sortable-ghost { opacity: 0.4; background: #eee; }
        .item-top { display: flex; align-items: flex-start; }
        .drag-handle { display: none; color: #ccc; font-size: 20px; margin-right: 15px; cursor: grab; padding-top: 2px; }

        .chk-wrap { width: 22px; height: 22px; margin-right: 12px; position: relative; flex-shrink: 0; margin-top: 2px;}
        .chk-wrap input { position: absolute; width: 100%; height: 100%; opacity: 0; cursor: pointer; z-index: 2;}
        .chk-box { width: 100%; height: 100%; border: 2px solid #ddd; border-radius: 6px; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .chk-wrap input:checked + .chk-box { background: var(--main-color); border-color: var(--main-color); }
        .chk-box::after { content: 'âœ”'; color: white; font-size: 12px; display: none; }
        .chk-wrap input:checked + .chk-box::after { display: block; }

        .item-icon { font-size: 20px; margin-right: 12px; width: 25px; text-align: center; flex-shrink: 0;}
        .item-content { flex: 1; }
        .item-name { font-size: 15px; font-weight: 600; color: #333; margin-bottom: 6px; display: block;}
        
        .tag-row { display: flex; flex-wrap: wrap; gap: 6px; align-items: center; }
        .tag { padding: 3px 6px; border-radius: 4px; font-size: 11px; color: #666; background: #f0f0f0; }
        .tag.brand { background: #FFF3E0; color: #E65100; font-weight: 600; }
        .tag.model { background: #ECEFF1; color: #455A64; font-weight: 600; }
        .tag.price { background: #fff0f0; color: var(--price-color); font-weight: 600; }
        .tag.count { background: #e8f5e9; color: #2e7d32; }
        .tag.carrot { background: #FFF3E0; color: #FF8A3D; font-weight: 800; border: 1px solid #FFCCBC; }

        .link-btn { text-decoration: none; background: #E3F2FD; color: #1565C0; padding: 3px 6px; border-radius: 4px; font-size: 11px; font-weight: bold; }
        .naver-btn { text-decoration: none; background: #03C75A; color: white; padding: 3px 6px; border-radius: 4px; font-size: 11px; font-weight: bold; display: inline-flex; align-items: center; gap: 2px; }
        .item-memo { margin-top: 8px; padding: 8px 10px; background: #FAFAFA; border-radius: 6px; font-size: 12px; color: #777; line-height: 1.4; display: block; border-left: 2px solid #eee; }
        .item-actions { display: none; gap: 8px; margin-left: 10px; align-self: flex-start; }
        .btn-icon { color: #ddd; font-size: 16px; cursor: pointer; padding: 2px; }
        
        body.is-edit-mode .btn-edit-cat { display: block; }
        body.is-edit-mode .btn-delete-cat { display: block; }
        body.is-edit-mode .item-actions { display: flex; }
        body.is-edit-mode .drag-handle { display: block; }
        body.is-edit-mode .drag-handle-cat { display: block; }
        body.is-edit-mode .chk-wrap { display: none; }

        .item.completed .item-name { text-decoration: line-through; color: #ccc; }
        .item.completed .item-icon { opacity: 0.5; }
        .btn-add-item { width: 100%; padding: 12px; background: white; border: none; color: var(--main-color); font-weight: bold; cursor: pointer; border-top: 1px solid #f0f0f0; font-size: 13px; }
        .fab-btn { position: fixed; bottom: 30px; right: 25px; background: var(--main-color); color: white; width: 55px; height: 55px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; box-shadow: 0 4px 15px rgba(255, 135, 141, 0.4); border: none; cursor: pointer; z-index: 99; }

        .excel-zone { background: white; margin: 20px; padding: 20px; border-radius: 16px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); text-align: center; }
        .excel-btn { background: #27ae60; color: white; border: none; padding: 10px 15px; border-radius: 8px; font-weight: bold; cursor: pointer; margin: 5px; font-size: 14px; box-shadow: 0 4px 10px rgba(39, 174, 96, 0.3); }
        .excel-btn.upload { background: #2980b9; box-shadow: 0 4px 10px rgba(41, 128, 185, 0.3); }
        .file-input-hidden { display: none; }

        /* ìë™ ë“±ë¡ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .auto-fill-btn {
            display: block; width: 90%; margin: 20px auto;
            padding: 15px; background: #6c5ce7; color: white;
            border: none; border-radius: 12px; font-weight: bold; font-size: 16px;
            cursor: pointer; box-shadow: 0 4px 15px rgba(108, 92, 231, 0.3);
        }
        .auto-fill-btn:active { transform: scale(0.98); }

        /* ëª¨ë‹¬ */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 200; align-items: center; justify-content: center; }
        .modal { background: white; width: 90%; max-width: 400px; padding: 25px; border-radius: 20px; max-height: 90vh; overflow-y: auto; }
        .input-group { margin-bottom: 12px; }
        .input-label { display: block; font-size: 12px; color: #888; margin-bottom: 5px; }
        .input-field { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; font-size: 15px; outline: none; }
        
        .icon-search-box { position: sticky; top: 0; background: white; padding-bottom: 10px; z-index: 10; }
        .icon-search-input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 8px; font-size: 13px; background: #f9f9f9; }
        .icon-grid { height: 180px; overflow-y: scroll; border: 1px solid #eee; border-radius: 10px; padding: 10px; display: grid; grid-template-columns: repeat(6, 1fr); gap: 5px; margin-bottom: 15px; }
        .icon-opt { font-size: 22px; text-align: center; padding: 8px; border-radius: 8px; cursor: pointer; }
        .icon-opt.selected { background: var(--sub-color); border: 1px solid var(--main-color); }
        .btn-row { display: flex; gap: 10px; margin-top: 20px; }
        .btn { flex: 1; padding: 14px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .btn-cancel { background: #f5f5f5; color: #666; }
        .btn-confirm { background: var(--main-color); color: white; }
        .option-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; background: #f9f9f9; padding: 10px; border-radius: 8px; }
        .option-label { display: flex; align-items: center; font-size: 14px; color: #555; cursor: pointer; }
        .option-chk { width: 18px; height: 18px; margin-right: 8px; cursor: pointer; accent-color: var(--main-color); }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-top-row">
                <h2>ğŸ‘¶ ìœ¡ì•„ ì¤€ë¹„ ë¦¬ìŠ¤íŠ¸</h2>
                <div class="edit-toggle-wrap">
                    <span>í¸ì§‘ ëª¨ë“œ</span>
                    <label class="switch">
                        <input type="checkbox" id="editModeSwitch" onchange="window.toggleEditMode(this.checked)">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            <div style="text-align: right;"><div class="total-budget-badge">ì´ ì˜ˆì‚° <span id="grandTotal">0</span>ì›</div></div>
            <div class="progress-box">
                <div class="progress-circle" id="percentTxt">0%</div>
                <div class="progress-bar-bg"><div class="progress-bar" id="progressBar"></div></div>
                <div class="total-info"><div id="checkCount">0 / 0 ì™„ë£Œ</div></div>
            </div>
        </div>

        <div id="contentArea"></div>
        
        <div id="emptyGuide" style="text-align:center; padding:60px; color:#aaa; display:none; font-size:14px;">
            <p>ì•„ì§ ë“±ë¡ëœ í•­ëª©ì´ ì—†ì–´ìš”.</p>
            <button class="auto-fill-btn" onclick="uploadInitialData()">ğŸ“ ë¬¼í’ˆ ë¦¬ìŠ¤íŠ¸ 80ì¢… ìë™ ë“±ë¡í•˜ê¸°</button>
        </div>

        <div class="excel-zone">
            <h3>ğŸ“Š ì—‘ì…€ ëŒ€ëŸ‰ ë“±ë¡</h3>
            <p style="font-size:12px; color:#666; margin-bottom:15px;">1. ì–‘ì‹ ë‹¤ìš´ë¡œë“œ â†’ 2. ì‘ì„± â†’ 3. ì—…ë¡œë“œ</p>
            <button class="excel-btn" onclick="downloadTemplate()">ğŸ“¥ ì–‘ì‹ ë‹¤ìš´ë¡œë“œ</button>
            <button class="excel-btn upload" onclick="document.getElementById('excelInput').click()">ğŸ“¤ ì‘ì„±í•œ ì—‘ì…€ ì—…ë¡œë“œ</button>
            <input type="file" id="excelInput" class="file-input-hidden" accept=".xlsx, .xls" onchange="handleExcelUpload(this)">
        </div>
        
        <div style="text-align:center; margin-top:20px;">
             <button class="auto-fill-btn" style="background:#a29bfe; font-size:13px; padding:10px; width:auto; display:inline-block;" onclick="if(confirm('ì¤‘ë³µë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¶”ê°€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) uploadInitialData()">ğŸ“¥ ë¦¬ìŠ¤íŠ¸ ê°•ì œ ì¶”ê°€</button>
        </div>
    </div>

    <button class="fab-btn" onclick="openCatModal()">+</button>

    <div id="catModal" class="modal-overlay">
        <div class="modal">
            <h3 id="catModalTitle">ğŸ“‚ ì¹´í…Œê³ ë¦¬ ì¶”ê°€</h3>
            <input type="hidden" id="editCatId">
            <div class="input-label">ì•„ì´ì½˜ ì„ íƒ</div>
            <div class="icon-search-box">
                <input type="text" class="icon-search-input" placeholder="ğŸ” ì•„ì´ì½˜ ê²€ìƒ‰ (ì˜ˆ: ìš°ìœ , ì°¨, ë³‘ì›)" onkeyup="filterIcons(this.value, 'catIconGrid')">
            </div>
            <div class="icon-grid" id="catIconGrid"></div>
            <div class="input-group"><input type="text" id="catName" class="input-field" placeholder="ì´ë¦„ (ì˜ˆ: ëª©ìš•/ìœ„ìƒ)"></div>
            <div class="btn-row">
                <button class="btn btn-cancel" onclick="closeModal('catModal')">ì·¨ì†Œ</button>
                <button class="btn btn-confirm" onclick="saveCategory()">ì €ì¥í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <div id="itemModal" class="modal-overlay">
        <div class="modal">
            <h3 id="itemModalTitle">âœ¨ ë¬¼í’ˆ ë“±ë¡</h3>
            <input type="hidden" id="targetCatId"><input type="hidden" id="targetItemId">
            
            <div class="input-label">ì•„ì´ì½˜ ì„ íƒ</div>
            <div class="icon-search-box">
                <input type="text" class="icon-search-input" placeholder="ğŸ” ì•„ì´ì½˜ ê²€ìƒ‰ (ì˜ˆ: ì –ë³‘, ì˜·, ëˆ)" onkeyup="filterIcons(this.value, 'itemIconGrid')">
            </div>
            <div class="icon-grid" id="itemIconGrid"></div>
            
            <div class="input-group"><input type="text" id="itemName" class="input-field" placeholder="ë¬¼í’ˆëª… (ì˜ˆ: ì²´ì˜¨ê³„)"></div>
            <div style="display:flex; gap:10px; margin-bottom:12px;">
                <div style="flex:1"><label class="input-label">ë¸Œëœë“œ</label><input type="text" id="itemBrand" class="input-field" placeholder="ì˜ˆ: ë¸Œë¼ìš´"></div>
                <div style="flex:1"><label class="input-label">ëª¨ë¸ëª…</label><input type="text" id="itemModel" class="input-field" placeholder="ì˜ˆ: IRT-6520"></div>
            </div>
            <div style="display:flex; gap:10px; margin-bottom:12px;">
                <div style="width: 80px;"><label class="input-label">ìˆ˜ëŸ‰</label><input type="number" id="itemCount" class="input-field" placeholder="1" value="1"></div>
                <div style="flex:1"><label class="input-label">ì˜ˆìƒ ê°€ê²©</label><input type="text" id="itemPrice" class="input-field" placeholder="ìˆ«ìë§Œ ì…ë ¥"></div>
            </div>
            <div class="input-group"><input type="url" id="itemLink" class="input-field" placeholder="êµ¬ë§¤ ë§í¬ (URL)"></div>
            <div class="input-group"><label class="input-label">ìƒì„¸ ë©”ëª¨</label><textarea id="itemMemo" class="input-field" placeholder="ë©”ëª¨ ì…ë ¥..."></textarea></div>
            
            <div class="option-row">
                <label class="option-label"><input type="checkbox" id="itemIsCarrot" class="option-chk"> ğŸ¥• ë‹¹ê·¼/ì¤‘ê³  êµ¬ë§¤</label>
            </div>
            <div class="option-row">
                <label class="option-label"><input type="checkbox" id="itemShowNaver" class="option-chk" checked> ğŸ” ë„¤ì´ë²„ ìµœì €ê°€ ë²„íŠ¼ í‘œì‹œ</label>
            </div>

            <div class="btn-row">
                <button class="btn btn-cancel" onclick="closeModal('itemModal')">ì·¨ì†Œ</button>
                <button class="btn btn-confirm" onclick="saveItem()">ì €ì¥í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, onValue, push, update, remove } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

        // ğŸ”´ğŸ”´ ë³¸ì¸ í‚¤ê°’ êµì²´ ğŸ”´ğŸ”´
        const firebaseConfig = {
            apiKey: "AIzaSyCovHk7sYoMTkZ8H5RwKjUWMXAqi50l2L-k",
            authDomain: "checklist-3c59d.firebaseapp.com",
            databaseURL: "https://checklist-3c59d-default-rtdb.firebaseio.com",
            projectId: "checklist-3c59d",
            storageBucket: "checklist-3c59d.firebasestorage.app",
            messagingSenderId: "624967682899",
            appId: "1:624967682899:web:a6640fa7b63ee2eab9afa6"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const dbRef = ref(db, 'baby_checklist_v6'); 

        // ì•„ì´ì½˜ DB (ì¶•ì•½ë¨)
        const iconDB = [
            {icon:'ğŸ‘¶', t:'ì•„ê¸° ë² ì´ë¹„ ì–¼êµ´ ì‹ ìƒì•„'}, {icon:'ğŸ‘§', t:'ì—¬ì ì•„ì´ ë”¸'}, {icon:'ğŸ§’', t:'ì•„ì´ ì–´ë¦°ì´'}, {icon:'ğŸ‘¦', t:'ë‚¨ì ì•„ì´ ì•„ë“¤'}, 
            {icon:'ğŸ¤°', t:'ì„ì‹  ì„ì‚°ë¶€ ì—„ë§ˆ'}, {icon:'ğŸ¤±', t:'ìˆ˜ìœ  ëª¨ìœ  ì—„ë§ˆ'}, {icon:'ğŸ‘¼', t:'ì²œì‚¬ ì•„ê¸°'}, {icon:'ğŸ¥', t:'ë³‘ì› ì†Œì•„ê³¼ ì¡°ë¦¬ì›'}, 
            {icon:'ğŸš‘', t:'êµ¬ê¸‰ì°¨ ì‘ê¸‰'}, {icon:'ğŸ©º', t:'ì²­ì§„ê¸° ì§„ì°° ì˜ì‚¬'}, {icon:'ğŸ’Š', t:'ì•½ ì•Œì•½ ì˜ì–‘ì œ'}, {icon:'ğŸ’‰', t:'ì£¼ì‚¬ ì˜ˆë°©ì ‘ì¢…'}, 
            {icon:'ğŸ©¹', t:'ë°´ë“œ ìƒì²˜ ì—°ê³ '}, {icon:'ğŸŒ¡ï¸', t:'ì²´ì˜¨ê³„ ì˜¨ë„ ì—´'}, {icon:'ğŸ˜·', t:'ë§ˆìŠ¤í¬ ê°ê¸°'}, {icon:'ğŸ¼', t:'ì –ë³‘ ìš°ìœ  ë¶„ìœ '}, 
            {icon:'ğŸ¥£', t:'ì´ìœ ì‹ ë°¥ê·¸ë¦‡ ì£½'}, {icon:'ğŸ¥„', t:'ìˆŸê°€ë½ ìŠ¤í‘¼'}, {icon:'ğŸ¥¡', t:'ë„ì‹œë½'}, {icon:'ğŸª', t:'ê³¼ì ê°„ì‹'}, 
            {icon:'ğŸ¥›', t:'ìš°ìœ  ì»µ ë¬¼'}, {icon:'ğŸ§Š', t:'ì–¼ìŒ'}, {icon:'ğŸ¥¢', t:'ì “ê°€ë½'}, {icon:'ğŸ½ï¸', t:'ì‹ì‚¬ ì ‘ì‹œ'}, {icon:'ğŸ§‚', t:'ì†Œê¸ˆ ì–‘ë…'}, 
            {icon:'ğŸ', t:'ì‚¬ê³¼ ê³¼ì¼'}, {icon:'ğŸŒ', t:'ë°”ë‚˜ë‚˜'}, {icon:'ğŸ¥¦', t:'ë¸Œë¡œì½œë¦¬ ì•¼ì±„'}, {icon:'ğŸ¥•', t:'ë‹¹ê·¼'}, {icon:'ğŸŒ½', t:'ì˜¥ìˆ˜ìˆ˜'}, 
            {icon:'ğŸ¥©', t:'ê³ ê¸° ì´ìœ ì‹'}, {icon:'ğŸ—', t:'ì¹˜í‚¨ ë‹­'}, {icon:'ğŸ', t:'ë¹µ ì‹ë¹µ'}, {icon:'ğŸ¥¨', t:'í”„ë ˆì²¼'}, {icon:'ğŸ©', t:'ë„ë„›'}, 
            {icon:'ğŸ¦', t:'ì•„ì´ìŠ¤í¬ë¦¼'}, {icon:'ğŸ°', t:'ì¼€ì´í¬ ìƒì¼'}, {icon:'ğŸ«', t:'ì´ˆì½œë¦¿'}, {icon:'ğŸ¬', t:'ì‚¬íƒ•'}, {icon:'ğŸ­', t:'ë§‰ëŒ€ì‚¬íƒ•'}, 
            {icon:'ğŸ§ƒ', t:'ì£¼ìŠ¤ íŒ©'}, {icon:'â˜•', t:'ì»¤í”¼'}, {icon:'ğŸ›', t:'ìš•ì¡° ëª©ìš• ì”»ê¸°'}, {icon:'ğŸš¿', t:'ìƒ¤ì›Œ ë¬¼'}, {icon:'ğŸ§¼', t:'ë¹„ëˆ„ ì„¸ì •ì œ'}, 
            {icon:'ğŸ§½', t:'ìŠ¤í€ì§€ ìˆ˜ì„¸ë¯¸'}, {icon:'ğŸ§»', t:'íœ´ì§€ ë‘ë£¨ë§ˆë¦¬'}, {icon:'ğŸ§´', t:'ë¡œì…˜ ìƒ´í‘¸'}, {icon:'ğŸª¥', t:'ì¹«ì†” ì–‘ì¹˜'}, {icon:'ğŸš½', t:'ë³€ê¸° í™”ì¥ì‹¤'}, 
            {icon:'ğŸ’©', t:'ë˜¥ ê¸°ì €ê·€'}, {icon:'ğŸ§¹', t:'ë¹—ìë£¨ ì²­ì†Œ'}, {icon:'ğŸ—‘ï¸', t:'ì“°ë ˆê¸°í†µ'}, {icon:'ğŸ§º', t:'ë¹¨ë˜ ë°”êµ¬ë‹ˆ ì„¸íƒ'}, {icon:'ğŸ‘•', t:'ì˜· í‹°ì…”ì¸  ìƒì˜'}, 
            {icon:'ğŸ‘–', t:'ë°”ì§€ í•˜ì˜'}, {icon:'ğŸ§¦', t:'ì–‘ë§'}, {icon:'ğŸ§¢', t:'ëª¨ì'}, {icon:'ğŸ§¤', t:'ì¥ê°‘'}, {icon:'ğŸ§£', t:'ëª©ë„ë¦¬ ìŠ¤ì¹´í”„'}, 
            {icon:'ğŸ‘Ÿ', t:'ì‹ ë°œ ìš´ë™í™”'}, {icon:'ğŸ€', t:'ë¦¬ë³¸ ë¨¸ë¦¬í•€'}, {icon:'ğŸ‘—', t:'ì›í”¼ìŠ¤ ë“œë ˆìŠ¤'}, {icon:'ğŸ§¥', t:'ì½”íŠ¸ ì í¼ ê²‰ì˜·'}, {icon:'ğŸ‘™', t:'ìˆ˜ì˜ë³µ'}, 
            {icon:'ğŸ‘š', t:'ë¸”ë¼ìš°ìŠ¤ ì—¬ìì˜·'}, {icon:'ğŸ‘”', t:'ë„¥íƒ€ì´ ì •ì¥'}, {icon:'ğŸ©³', t:'ë°˜ë°”ì§€ ì†ì˜·'}, {icon:'ğŸ‘“', t:'ì•ˆê²½'}, {icon:'ğŸ•¶ï¸', t:'ì„ ê¸€ë¼ìŠ¤'}, 
            {icon:'ğŸ’', t:'ë°˜ì§€ ë³´ì„'}, {icon:'ğŸ’', t:'ê°€ë°© ë°±íŒ©'}, {icon:'ğŸ‘œ', t:'í•¸ë“œë°± ê°€ë°©'}, {icon:'ğŸ‘›', t:'ì§€ê°‘ ë™ì „'}, {icon:'ğŸ›ï¸', t:'ì¹¨ëŒ€ ì  ìˆ˜ë©´'}, 
            {icon:'ğŸ›Œ', t:'ìë‹¤ ì´ë¶ˆ'}, {icon:'ğŸ§¸', t:'ê³°ì¸í˜• ì¥ë‚œê° ì• ì°©'}, {icon:'ğŸª', t:'ì—° ì—°ë‚ ë¦¬ê¸°'}, {icon:'âš½', t:'ê³µ ì¶•êµ¬'}, {icon:'ğŸ¨', t:'ë¯¸ìˆ  ê·¸ë¦¼ ë¬¼ê°'}, 
            {icon:'ğŸ“š', t:'ì±… ë™í™”ì±… ê³µë¶€'}, {icon:'ğŸ ', t:'íšŒì „ëª©ë§ˆ ë†€ì´ê³µì›'}, {icon:'ğŸ¡', t:'ê´€ëŒì°¨'}, {icon:'ğŸˆ', t:'í’ì„  íŒŒí‹°'}, {icon:'ğŸ‰', t:'í­ì£½ ì¶•í•˜'}, 
            {icon:'ğŸ®', t:'ê²Œì„ ì˜¤ë½'}, {icon:'ğŸ²', t:'ì£¼ì‚¬ìœ„'}, {icon:'ğŸ§©', t:'í¼ì¦'}, {icon:'ğŸ¹', t:'í”¼ì•„ë…¸ ìŒì•…'}, {icon:'ğŸ¥', t:'ë¶ ë“œëŸ¼'}, 
            {icon:'ğŸ·', t:'ìƒ‰ì†Œí°'}, {icon:'ğŸº', t:'ë‚˜íŒ”'}, {icon:'ğŸ¸', t:'ê¸°íƒ€'}, {icon:'ğŸ»', t:'ë°”ì´ì˜¬ë¦°'}, {icon:'ğŸš—', t:'ìë™ì°¨ ì°¨ ì¹´ì‹œíŠ¸'}, 
            {icon:'ğŸš•', t:'íƒì‹œ'}, {icon:'ğŸšŒ', t:'ë²„ìŠ¤'}, {icon:'âœˆï¸', t:'ë¹„í–‰ê¸° ì—¬í–‰'}, {icon:'ğŸš²', t:'ìì „ê±°'}, {icon:'ğŸ›µ', t:'ì˜¤í† ë°”ì´'}, 
            {icon:'ğŸ›´', t:'í‚¥ë³´ë“œ'}, {icon:'ğŸš¤', t:'ë³´íŠ¸ ë°°'}, {icon:'ğŸš€', t:'ë¡œì¼“ ìš°ì£¼'}, {icon:'ğŸ›’', t:'ì¹´íŠ¸ ì‡¼í•‘ ë§ˆíŠ¸'}, {icon:'ğŸ›ï¸', t:'ì‡¼í•‘ë°± ì„ ë¬¼'}, 
            {icon:'ğŸ“·', t:'ì¹´ë©”ë¼ ì‚¬ì§„'}, {icon:'ğŸ“¹', t:'ë¹„ë””ì˜¤ ì˜ìƒ'}, {icon:'ğŸ“±', t:'í•¸ë“œí° ìŠ¤ë§ˆíŠ¸í°'}, {icon:'ğŸ’»', t:'ë…¸íŠ¸ë¶ ì»´í“¨í„°'}, {icon:'ğŸ”‹', t:'ë°°í„°ë¦¬ ê±´ì „ì§€'}, 
            {icon:'ğŸ”Œ', t:'í”ŒëŸ¬ê·¸ ì „ê¸° ë©€í‹°íƒ­'}, {icon:'ğŸ ', t:'ì§‘ í™ˆ'}, {icon:'ğŸ›‹ï¸', t:'ì†ŒíŒŒ ê°€êµ¬'}, {icon:'ğŸª‘', t:'ì˜ì'}, {icon:'ğŸšª', t:'ë¬¸'}, 
            {icon:'ğŸ”‘', t:'ì—´ì‡  í‚¤'}, {icon:'ğŸ–¼ï¸', t:'ì•¡ì ì‚¬ì§„'}, {icon:'ğŸª´', t:'í™”ë¶„ ì‹ë¬¼'}, {icon:'ğŸŒµ', t:'ì„ ì¸ì¥'}, {icon:'ğŸ’', t:'ê½ƒë‹¤ë°œ'}, 
            {icon:'ğŸ•°ï¸', t:'ì‹œê³„ ì‹œê°„'}, {icon:'ğŸ’¡', t:'ì „êµ¬ ë¶ˆ ë¹›'}, {icon:'ğŸ•¯ï¸', t:'ì–‘ì´ˆ ìº”ë“¤'}, {icon:'ğŸ“¦', t:'ìƒì íƒë°° ë°•ìŠ¤'}, {icon:'âœ‰ï¸', t:'í¸ì§€ ë´‰íˆ¬'}, 
            {icon:'âœ‚ï¸', t:'ê°€ìœ„'}, {icon:'ğŸ“Œ', t:'í•€ ì••ì •'}, {icon:'ğŸ“', t:'í´ë¦½'}, {icon:'ğŸ“', t:'ì ì¤„ì'}, {icon:'â˜€ï¸', t:'í•´ ë‚ ì”¨ ë§‘ìŒ'}, 
            {icon:'â˜ï¸', t:'êµ¬ë¦„ íë¦¼'}, {icon:'â˜”', t:'ë¹„ ìš°ì‚°'}, {icon:'â„ï¸', t:'ëˆˆ ê²¨ìš¸'}, {icon:'âš¡', t:'ë²ˆê°œ ì „ê¸°'}, {icon:'ğŸŒˆ', t:'ë¬´ì§€ê°œ'}, 
            {icon:'â­', t:'ë³„ ìŠ¤íƒ€'}, {icon:'ğŸŒ™', t:'ë‹¬ ë°¤'}, {icon:'ğŸ”¥', t:'ë¶ˆ ëœ¨ê±°ì›€'}, {icon:'ğŸ’§', t:'ë¬¼ ë°©ìš¸ ìŠµê¸°'}, {icon:'â¤ï¸', t:'í•˜íŠ¸ ì‚¬ë‘'}, 
            {icon:'ğŸ§¡', t:'ì£¼í™©í•˜íŠ¸'}, {icon:'ğŸ’›', t:'ë…¸ë‘í•˜íŠ¸'}, {icon:'ğŸ’š', t:'ì´ˆë¡í•˜íŠ¸'}, {icon:'ğŸ’™', t:'íŒŒë‘í•˜íŠ¸'}, {icon:'ğŸ’œ', t:'ë³´ë¼í•˜íŠ¸'}, 
            {icon:'ğŸ–¤', t:'ê²€ì •í•˜íŠ¸'}, {icon:'ğŸ¤', t:'í°ìƒ‰í•˜íŠ¸'}, {icon:'ğŸ¤', t:'ê°ˆìƒ‰í•˜íŠ¸'}, {icon:'ğŸ’”', t:'ê¹¨ì§„í•˜íŠ¸'}, {icon:'ğŸ’¯', t:'ë°±ì  ë§Œì '}, 
            {icon:'âœ…', t:'ì²´í¬ ì™„ë£Œ'}, {icon:'âŒ', t:'ì—‘ìŠ¤ ì·¨ì†Œ'}, {icon:'â“', t:'ë¬¼ìŒí‘œ ì§ˆë¬¸'}, {icon:'â—ï¸', t:'ëŠë‚Œí‘œ ì¤‘ìš”'}, {icon:'ğŸ’°', t:'ëˆ ìê¸ˆ ì˜ˆì‚°'}, 
            {icon:'ğŸ’³', t:'ì¹´ë“œ ê²°ì œ'}, {icon:'ğŸ“…', t:'ë‹¬ë ¥ ë‚ ì§œ ë””ë°ì´'}, {icon:'ğŸ“', t:'ë©”ëª¨ ê¸°ë¡'}, {icon:'ğŸ', t:'ì„ ë¬¼ ë°•ìŠ¤'}, {icon:'ğŸ””', t:'ì¢… ì•Œë¦¼'}, 
            {icon:'ğŸµ', t:'ìŒí‘œ ë…¸ë˜'}, {icon:'ğŸ¶', t:'ìŒì•…'}
        ];
        
        let selectedIcon = 'ğŸ‘¶';
        let currentData = {};
        let catSortable = null;

        onValue(dbRef, (snapshot) => {
            currentData = snapshot.val() || {};
            renderApp(currentData);
        });

        function renderApp(data) {
            const contentArea = document.getElementById('contentArea');
            if(document.body.classList.contains('is-dragging')) return;
            contentArea.innerHTML = '';
            
            let totalCount = 0; let checkedCount = 0; let grandTotalPrice = 0;
            const isEmpty = Object.keys(data).length === 0;
            document.getElementById('emptyGuide').style.display = isEmpty ? 'block' : 'none';

            let catArray = Object.keys(data).map(key => ({...data[key], id: key}));
            catArray.sort((a, b) => (a.order || 0) - (b.order || 0));

            catArray.forEach(cat => {
                const itemsObj = cat.items || {};
                let itemsArray = Object.keys(itemsObj).map(key => ({...itemsObj[key], id: key}));
                itemsArray.sort((a, b) => (a.order || 0) - (b.order || 0));

                let catTotalPrice = 0;
                let itemListHTML = '';

                itemsArray.forEach(item => {
                    totalCount++;
                    if(item.checked) checkedCount++;
                    const price = parseInt((item.price || '0').toString().replace(/,/g, '')) || 0;
                    const count = parseInt(item.count) || 1;
                    catTotalPrice += (price * count);

                    let tags = '';
                    if(item.brand) tags += `<span class="tag brand">${item.brand}</span> `;
                    if(item.model) tags += `<span class="tag model">${item.model}</span> `;
                    if(item.isCarrot) tags += `<span class="tag carrot">ğŸ¥• ë‹¹ê·¼</span> `;
                    if(item.price) tags += `<span class="tag price">${Number(price).toLocaleString()}ì›</span> `;
                    if(item.link) tags += `<a href="${item.link}" target="_blank" class="link-btn">ğŸ”— êµ¬ë§¤</a>`;

                    const showNaver = (item.showNaver !== false); 
                    if(showNaver) {
                        let queryParts = [item.brand, item.model, item.name].filter(Boolean);
                        const searchUrl = `https://search.shopping.naver.com/search/all?query=${encodeURIComponent(queryParts.join(' '))}`;
                        tags += `<a href="${searchUrl}" target="_blank" class="naver-btn">N ìµœì €ê°€</a>`;
                    }

                    let memoHTML = item.memo ? `<div class="item-memo">${item.memo.replace(/\n/g, '<br>')}</div>` : '';

                    itemListHTML += `
                    <li class="item ${item.checked ? 'completed' : ''}" data-id="${item.id}">
                        <div class="item-top">
                            <div class="drag-handle">â˜°</div>
                            <div class="chk-wrap">
                                <input type="checkbox" ${item.checked ? 'checked' : ''} onchange="window.toggleCheck('${cat.id}', '${item.id}', this.checked)">
                                <div class="chk-box"></div>
                            </div>
                            <div class="item-icon">${item.icon || 'ğŸ‘¶'}</div>
                            <div class="item-content">
                                <span class="item-name">${item.name}</span>
                                <div class="tag-row">${tags}</div>
                                ${memoHTML}
                            </div>
                            <div class="item-actions">
                                <span class="btn-icon btn-edit" onclick="window.openEditItem('${cat.id}', '${item.id}')">âœï¸</span>
                                <span class="btn-icon btn-del" onclick="window.deleteItem('${cat.id}', '${item.id}')">ğŸ—‘ï¸</span>
                            </div>
                        </div>
                    </li>`;
                });

                grandTotalPrice += catTotalPrice;
                const catDiv = document.createElement('div');
                catDiv.className = 'category-card';
                catDiv.setAttribute('data-id', cat.id);
                catDiv.innerHTML = `
                    <div class="cat-header">
                        <div class="cat-left">
                            <div class="drag-handle-cat">â˜°</div>
                            <div class="cat-icon">${cat.icon}</div>
                            <div>
                                <span class="cat-title">${cat.name}</span>
                                <span class="cat-sum">(${catTotalPrice.toLocaleString()}ì›)</span>
                            </div>
                        </div>
                        <div class="cat-actions">
                            <span class="btn-edit-cat" onclick="window.openEditCategory('${cat.id}')">âœï¸</span>
                            <span class="btn-delete-cat" onclick="window.deleteCategory('${cat.id}')">âŒ</span>
                        </div>
                    </div>
                    <ul class="item-list" id="list-${cat.id}" data-cat-id="${cat.id}">${itemListHTML}</ul>
                    <button class="btn-add-item" onclick="window.openAddItem('${cat.id}')">+ ë¬¼í’ˆ ì¶”ê°€í•˜ê¸°</button>
                `;
                contentArea.appendChild(catDiv);
                initItemSortable(catDiv.querySelector(`#list-${cat.id}`), cat.id);
            });

            if(!catSortable) initCategorySortable();
            const percent = totalCount === 0 ? 0 : Math.round((checkedCount / totalCount) * 100);
            document.getElementById('progressBar').style.width = `${percent}%`;
            document.getElementById('percentTxt').innerText = `${percent}%`;
            document.getElementById('checkCount').innerText = `${checkedCount} / ${totalCount} ì™„ë£Œ`;
            document.getElementById('grandTotal').innerText = grandTotalPrice.toLocaleString();
            
            window.toggleEditMode(document.getElementById('editModeSwitch').checked);
        }

        // ==========================================
        // ğŸš€ ì•„ì´ì½˜ ì™„ë²½ ë§¤ì¹­ ìë™ ë“±ë¡ ë¡œì§
        // ==========================================
        window.uploadInitialData = async () => {
            alert("ë¦¬ìŠ¤íŠ¸ì™€ ì•„ì´ì½˜ì„ ë§¤ì¹­í•˜ì—¬ ë“±ë¡í•©ë‹ˆë‹¤! (ì•½ 5~10ì´ˆ ì†Œìš”)");
            
            // ëª¨ë“  ì•„ì´í…œì— ê°œë³„ ì•„ì´ì½˜ í• ë‹¹
            const initialData = [
                {
                    name: "ì¶œì‚°ê°€ë°©/ì—„ë§ˆìš©í’ˆ", icon: "ğŸ¥",
                    items: [
                        {n:"ì‚°ëª¨ìˆ˜ì²©", i:"ğŸ“’"}, {n:"ì‹ ë¶„ì¦/ì§€ê°‘", i:"ğŸ’³"}, {n:"íœ´ëŒ€í°/ì¶©ì „ê¸°", i:"ğŸ“±"},
                        {n:"ë§ˆìŠ¤í¬", i:"ğŸ˜·"}, {n:"êµ¬ë¶€ëŸ¬ì§€ëŠ” ë¹¨ëŒ€", i:"ğŸ¥¤"}, {n:"ë¬¼í‹°ìŠˆ/ë§ˆì´ë¹„ë°", i:"ğŸ§»"},
                        {n:"ì² ë¶„ì œ(ì—„ë§ˆì˜ì–‘ì œ)", i:"ğŸ’Š"}, {n:"ê°€ìŠµê¸°", i:"ğŸ’§"}, {n:"ìŠ¤í‚¨ì¼€ì–´/ì„¸ë©´ë„êµ¬", i:"ğŸ§´"},
                        {n:"ìˆ˜ìœ ë‚˜ì‹œ/ë¸Œë¼/íŒ¨ë“œ", i:"ğŸ‘™"}, {n:"ì œì™•ì ˆê°œ íŒ¬í‹°", i:"ğŸ©²"}, {n:"ì–‘ë§/ëª©ìˆ˜ê±´", i:"ğŸ§¦"},
                        {n:"ìƒë¦¬ëŒ€/ë§˜ìŠ¤ì•ˆì‹¬íŒ¬í‹°", i:"ğŸ©¸"}, {n:"ì–‘ë°°ì¶” ê°€ìŠ´íŒ©", i:"ğŸ¥¬"}, {n:"ì‚°í›„ë³µëŒ€", i:"ğŸ¤•"},
                        {n:"ì†ëª©ë³´í˜¸ëŒ€", i:"ğŸ¤²"}, {n:"ì••ë°•ìŠ¤íƒ€í‚¹", i:"ğŸ‘¢"}, {n:"ë””ë°ì´ë‹¬ë ¥", i:"ğŸ“…"}, {n:"ë³¼íœ/ìŠ¬ë¦¬í¼", i:"ğŸ–Šï¸"}
                    ]
                },
                {
                    name: "ìœ„ìƒ/ì¼€ì–´", icon: "ğŸ©¹",
                    items: [
                        {n:"ì†ìˆ˜ê±´ 10ì¥", i:"ğŸ§£"}, {n:"ìœ ì‚°ê· ", i:"ğŸ¦ "}, {n:"ì†í†±ì¼€ì–´ 4ì¢…", i:"âœ‚ï¸"},
                        {n:"ì²´ì˜¨ê³„", i:"ğŸŒ¡ï¸"}, {n:"ì˜¨ìŠµë„ê³„", i:"ğŸ’§"}, {n:"ì•Œì½œìŠ¤ì™‘", i:"ğŸ¥"}, {n:"ë°°ê¼½ì†Œë…ì†œ", i:"â˜ï¸"}
                    ]
                },
                {
                    name: "ìˆ˜ìœ ìš©í’ˆ", icon: "ğŸ¼",
                    items: [
                        {n:"ëª¨ìœ ì €ì¥íŒ©", i:"ğŸ§Š"}, {n:"ìˆ˜ìœ ì»µ", i:"ğŸ¥›"}, {n:"ìˆ˜ìœ ì¿ ì…˜", i:"ğŸ©"},
                        {n:"ìœ ì¶•ê¸°", i:"ğŸ¤±"}, {n:"ë¶„ìœ ì œì¡°ê¸°", i:"ğŸ¤–"}, {n:"ë¶„ìœ ì‰ì´ì»¤", i:"ğŸ¥¤"},
                        {n:"ì –ë³‘(í°ê±°/ì‘ì€ê±°)", i:"ğŸ¼"}, {n:"ë¶„ìœ ", i:"ğŸ¥«"}, {n:"ë¶„ìœ í¬íŠ¸", i:"ğŸ«–"},
                        {n:"ì –ê¼­ì§€", i:"ğŸ¼"}, {n:"ì –ë³‘ì†”/ì§‘ê²Œ", i:"ğŸ–Œï¸"}, {n:"ì –ë³‘ê±´ì¡°ëŒ€", i:"ğŸŒµ"},
                        {n:"ì –ë³‘ì†Œë…ê¸°", i:"âœ¨"}, {n:"ì –ë³‘ì„¸ì •ì œ", i:"ğŸ§¼"}, {n:"íœ´ëŒ€ìš©ì –ë³‘", i:"ğŸ¼"},
                        {n:"ë³´ì˜¨ë³‘", i:"ğŸŒ¡ï¸"}, {n:"ê³µê°ˆì –ê¼­ì§€(ìª½ìª½ì´)", i:"ğŸ‘¶"}
                    ]
                },
                {
                    name: "ëª©ìš•/ì„¸íƒ", icon: "ğŸ›",
                    items: [
                        {n:"ê¸°ì €ê·€", i:"ğŸ©²"}, {n:"ì•„ê¸°ë¹„ë°", i:"ğŸš¿"}, {n:"ì²œê¸°ì €ê·€", i:"â¬œ"},
                        {n:"ì•„ê¸°ìš•ì¡°", i:"ğŸ›"}, {n:"ì‹ ìƒì•„ë©´ë´‰", i:"ğŸ‘‚"}, {n:"ê±´í‹°ìŠˆ", i:"ğŸ§»"},
                        {n:"ì„¸íƒì„¸ì œ", i:"ğŸ§´"}, {n:"ë¬´í˜•ê´‘ ì„¸íƒë§", i:"ğŸ•¸ï¸"}, {n:"ì¥ë‚œê° ì†Œë…ì œ", i:"ğŸ”«"},
                        {n:"ë°”ìŠ¤&ìƒ´í‘¸", i:"ğŸ§´"}, {n:"ë¡œì…˜/ì˜¤ì¼/ìˆ˜ë”©ì ¤", i:"ğŸ§´"}, {n:"ê¸°ì €ê·€ë°œì§„í¬ë¦¼", i:"ğŸ¥«"}, {n:"ë¹„íŒí… ì—°ê³ ", i:"ğŸ’Š"}
                    ]
                },
                {
                    name: "ê°€êµ¬/ì¹¨êµ¬/ì˜ë¥˜", icon: "ğŸ›ï¸",
                    items: [
                        {n:"ì•„ê¸°ì¹¨ëŒ€", i:"ğŸ›ï¸"}, {n:"ê¸°ì €ê·€ê°ˆì´ëŒ€", i:"ğŸš¼"}, {n:"íŠ¸ë¡¤ë¦¬(ë®ê°œí˜•)", i:"ğŸ›’"},
                        {n:"ì•„ê¸°ìˆ˜ë‚©ì¥", i:"ğŸ—„ï¸"}, {n:"ì•„ê¸°ì˜·ê±¸ì´", i:"ğŸ§¥"}, {n:"ë²”ë³´ì˜ì", i:"ğŸª‘"},
                        {n:"ë°©ìˆ˜íŒ¨ë“œ", i:"ğŸš«"}, {n:"ë¸”ë­í‚·/ì´ë¶ˆ", i:"ğŸ›Œ"}, {n:"ë°”ë””ìŠˆíŠ¸", i:"ğŸ‘•"},
                        {n:"ë°°ëƒ‡ì €ê³ ë¦¬/ìš°ì£¼ë³µ", i:"ğŸ‘˜"}, {n:"í„±ë°›ì´", i:"ğŸ‘¶"}, {n:"ë‚´ë³µ", i:"ğŸ‘•"}, {n:"ì–‘ë§", i:"ğŸ§¦"}
                    ]
                },
                {
                    name: "ì™¸ì¶œ/ê°€ì „/ê¸°íƒ€", icon: "ğŸš—",
                    items: [
                        {n:"ë°”êµ¬ë‹ˆì¹´ì‹œíŠ¸", i:"ğŸ§º"}, {n:"ì¹´ì‹œíŠ¸", i:"ğŸš—"}, {n:"ìœ ëª¨ì°¨", i:"ğŸ›’"},
                        {n:"ìœ ëª¨ì°¨ë¼ì´ë„ˆ", i:"ğŸ’º"}, {n:"í†µí’ì‹œíŠ¸", i:"â„ï¸"}, {n:"ì•„ê¸°ë ", i:"ğŸ¨"},
                        {n:"ì°¨ëŸ‰ìŠ¤í‹°ì»¤", i:"ğŸ”°"}, {n:"ì°¨ëŸ‰í–‡ë¹›ê°€ë¦¬ê°œ", i:"â˜€ï¸"}, {n:"ê¸°ì €ê·€ê°€ë°©", i:"ğŸ’"},
                        {n:"í•˜ì´ì²´ì–´", i:"ğŸª‘"}, {n:"ë¹¨ë˜ê±´ì¡°ëŒ€", i:"ğŸ§º"}, {n:"ë°±ìƒ‰ì†ŒìŒê¸°", i:"ğŸ“»"}, {n:"ëª¨ë¹Œ", i:"ğŸ "}
                    ]
                }
            ];

            for (let i = 0; i < initialData.length; i++) {
                const cat = initialData[i];
                const newCatRef = await push(ref(db, 'baby_checklist_v6'), {
                    name: cat.name, icon: cat.icon, order: i
                });
                const catId = newCatRef.key;
                if(cat.items && cat.items.length > 0) {
                    for (let j = 0; j < cat.items.length; j++) {
                        const item = cat.items[j];
                        await push(ref(db, `baby_checklist_v6/${catId}/items`), {
                            name: item.n, // ì´ë¦„
                            icon: item.i, // ê°œë³„ ì•„ì´ì½˜
                            checked: false, order: j, count: 1,
                            showNaver: true
                        });
                    }
                }
            }
            alert("âœ… ëª¨ë“  ì•„ì´í…œì´ ì•„ì´ì½˜ê³¼ í•¨ê»˜ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!");
        };

        // ... ë‚˜ë¨¸ì§€ í•¨ìˆ˜ë“¤ (ë³€ê²½ ì—†ìŒ) ...
        function initCategorySortable() { const el = document.getElementById('contentArea'); catSortable = new Sortable(el, { handle: '.drag-handle-cat', animation: 150, ghostClass: 'sortable-ghost', disabled: !document.getElementById('editModeSwitch').checked, onStart:()=>{document.body.classList.add('is-dragging')}, onEnd:()=>{document.body.classList.remove('is-dragging'); updateCategoryOrder(Array.from(el.children).map(div => div.getAttribute('data-id')))}}); }
        function updateCategoryOrder(newIds){ const updates={}; newIds.forEach((catId,idx)=>{updates[`baby_checklist_v6/${catId}/order`]=idx;}); update(ref(db),updates); }
        function initItemSortable(el, catId){ const sortable=new Sortable(el,{handle:'.drag-handle', animation:150, ghostClass:'sortable-ghost', disabled:!document.getElementById('editModeSwitch').checked, onStart:()=>{document.body.classList.add('is-dragging')}, onEnd:()=>{document.body.classList.remove('is-dragging'); updateItemOrder(catId, Array.from(el.children).map(li=>li.getAttribute('data-id')))}}); el.sortableInstance=sortable; }
        function updateItemOrder(catId,newIds){ const updates={}; newIds.forEach((itemId,idx)=>{updates[`baby_checklist_v6/${catId}/items/${itemId}/order`]=idx;}); update(ref(db),updates); }
        window.toggleEditMode = (isChecked) => { if(isChecked) { document.body.classList.add('is-edit-mode'); if(catSortable) catSortable.option("disabled", false); document.querySelectorAll('.item-list').forEach(el => el.sortableInstance?.option("disabled", false)); } else { document.body.classList.remove('is-edit-mode'); if(catSortable) catSortable.option("disabled", true); document.querySelectorAll('.item-list').forEach(el => el.sortableInstance?.option("disabled", true)); } };
        window.filterIcons = (keyword, targetGridId) => { if(!keyword) { renderIcons(iconDB, targetGridId); return; } const filtered = iconDB.filter(item => item.t.includes(keyword) || item.icon.includes(keyword)); renderIcons(filtered, targetGridId); };
        function renderIcons(list, targetGridId) { const grid = document.getElementById(targetGridId); grid.innerHTML = ''; list.forEach(item => { const el = document.createElement('div'); el.className = `icon-opt ${item.icon === selectedIcon ? 'selected' : ''}`; el.innerText = item.icon; el.onclick = () => { selectedIcon = item.icon; Array.from(grid.children).forEach(c => c.classList.remove('selected')); el.classList.add('selected'); }; grid.appendChild(el); }); }
        window.toggleCheck=(catId,itemId,checked)=>update(ref(db,`baby_checklist_v6/${catId}/items/${itemId}`),{checked});
        window.deleteCategory=(id)=>{if(confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) remove(ref(db,`baby_checklist_v6/${id}`));};
        window.deleteItem=(catId,itemId)=>{if(confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) remove(ref(db,`baby_checklist_v6/${catId}/items/${itemId}`));};
        window.closeModal=(id)=>document.getElementById(id).style.display='none';
        window.openCatModal = () => { document.getElementById('catModal').style.display = 'flex'; document.getElementById('catModalTitle').innerText = 'ğŸ“‚ ì¹´í…Œê³ ë¦¬ ì¶”ê°€'; document.getElementById('editCatId').value = ''; document.getElementById('catName').value = ''; selectedIcon = 'ğŸ‘¶'; renderIcons(iconDB, 'catIconGrid'); };
        window.openEditCategory = (catId) => { const cat = currentData[catId]; if(!cat) return; document.getElementById('catModal').style.display = 'flex'; document.getElementById('catModalTitle').innerText = 'âœï¸ ì¹´í…Œê³ ë¦¬ ìˆ˜ì •'; document.getElementById('editCatId').value = catId; document.getElementById('catName').value = cat.name; selectedIcon = cat.icon || 'ğŸ‘¶'; renderIcons(iconDB, 'catIconGrid'); };
        window.saveCategory = () => { const name = document.getElementById('catName').value; const editId = document.getElementById('editCatId').value; if(!name) return alert('ì´ë¦„ ì…ë ¥!'); if(editId) { update(ref(db, `baby_checklist_v6/${editId}`), { name, icon: selectedIcon }); } else { push(ref(db, 'baby_checklist_v6'), { name, icon: selectedIcon, order: 999 }); } window.closeModal('catModal'); };
        window.openAddItem=(catId)=>{document.getElementById('itemModal').style.display='flex'; document.getElementById('itemModalTitle').innerText='âœ¨ ë¬¼í’ˆ ë“±ë¡'; document.getElementById('targetCatId').value=catId; document.getElementById('targetItemId').value=''; document.getElementById('itemName').value=''; document.getElementById('itemBrand').value=''; document.getElementById('itemModel').value=''; document.getElementById('itemMemo').value=''; document.getElementById('itemCount').value='1'; document.getElementById('itemPrice').value=''; document.getElementById('itemLink').value=''; document.getElementById('itemIsCarrot').checked=false; document.getElementById('itemShowNaver').checked=true; selectedIcon='ğŸ‘¶'; renderIcons(iconDB,'itemIconGrid');};
        window.openEditItem=(catId,itemId)=>{const item=currentData[catId].items[itemId]; if(!item)return; document.getElementById('itemModal').style.display='flex'; document.getElementById('itemModalTitle').innerText='âœï¸ ë¬¼í’ˆ ìˆ˜ì •'; document.getElementById('targetCatId').value=catId; document.getElementById('targetItemId').value=itemId; document.getElementById('itemName').value=item.name; document.getElementById('itemBrand').value=item.brand||''; document.getElementById('itemModel').value=item.model||''; document.getElementById('itemMemo').value=item.memo||''; document.getElementById('itemCount').value=item.count||1; document.getElementById('itemPrice').value=item.price||''; document.getElementById('itemLink').value=item.link||''; document.getElementById('itemIsCarrot').checked=(item.isCarrot===true); document.getElementById('itemShowNaver').checked=(item.showNaver!==false); selectedIcon=item.icon||'ğŸ‘¶'; renderIcons(iconDB,'itemIconGrid');};
        window.saveItem=()=>{const catId=document.getElementById('targetCatId').value; const itemId=document.getElementById('targetItemId').value; const newData={name:document.getElementById('itemName').value, brand:document.getElementById('itemBrand').value, model:document.getElementById('itemModel').value, memo:document.getElementById('itemMemo').value, count:document.getElementById('itemCount').value, price:document.getElementById('itemPrice').value, link:document.getElementById('itemLink').value, icon:selectedIcon, checked:false, order:999, isCarrot:document.getElementById('itemIsCarrot').checked, showNaver:document.getElementById('itemShowNaver').checked}; if(!newData.name)return alert('ì´ë¦„ ì…ë ¥!'); if(itemId){const existing=currentData[catId].items[itemId]; newData.checked=existing.checked; newData.order=existing.order||999; update(ref(db,`baby_checklist_v6/${catId}/items/${itemId}`),newData);}else{push(ref(db,`baby_checklist_v6/${catId}/items`),newData);} window.closeModal('itemModal');};
        window.downloadTemplate=()=>{const header=["ì¹´í…Œê³ ë¦¬","ë¬¼í’ˆëª…","ë¸Œëœë“œ","ëª¨ë¸ëª…","ìˆ˜ëŸ‰","ì˜ˆìƒê°€ê²©","êµ¬ë§¤ë§í¬","ë©”ëª¨"]; const example=["ìœ„ìƒ/ì¼€ì–´","ì•„ê¸° ë©´ë´‰","ë§ˆì´ë¹„","",1,5000,"http://...","ì‹ ìƒì•„ìš© ì–‡ì€ê±°"]; const wb=XLSX.utils.book_new(); const ws=XLSX.utils.aoa_to_sheet([header,example]); XLSX.utils.book_append_sheet(wb,ws,"ìœ¡ì•„í…œ_ì–‘ì‹"); XLSX.writeFile(wb,"ìœ¡ì•„ì¤€ë¹„ë¬¼_ì–‘ì‹.xlsx");};
        window.handleExcelUpload=(input)=>{const file=input.files[0]; if(!file)return; const reader=new FileReader(); reader.onload=async(e)=>{const data=new Uint8Array(e.target.result); const workbook=XLSX.read(data,{type:'array'}); const firstSheet=workbook.Sheets[workbook.SheetNames[0]]; const rows=XLSX.utils.sheet_to_json(firstSheet,{header:1}); if(rows.length<2){alert("ë°ì´í„° ì—†ìŒ");return;} const dataRows=rows.slice(1); const grouped={}; dataRows.forEach(row=>{const catName=row[0]; const itemName=row[1]; if(!catName||!itemName)return; if(!grouped[catName])grouped[catName]=[]; grouped[catName].push({name:itemName, brand:row[2]||"", model:row[3]||"", count:row[4]||1, price:row[5]||"", link:row[6]||"", memo:row[7]||"", showNaver:true});}); if(confirm(`${Object.keys(grouped).length}ê°œ ì¹´í…Œê³ ë¦¬ ë“±ë¡?`)){for(const catName of Object.keys(grouped)){const newCatRef=await push(ref(db,'baby_checklist_v6'),{name:catName, icon:"ğŸ‘¶", order:999}); const catId=newCatRef.key; for(const item of grouped[catName]){await push(ref(db,`baby_checklist_v6/${catId}/items`),{...item, checked:false, order:999});}} alert("ì—…ë¡œë“œ ì™„ë£Œ!"); input.value="";}}; reader.readAsArrayBuffer(file);};
        window.searchNaver=()=>{const n=document.getElementById('itemName').value; const b=document.getElementById('itemBrand').value; const m=document.getElementById('itemModel').value; if(!n)return alert('ì´ë¦„ ì…ë ¥!'); window.open(`https://search.shopping.naver.com/search/all?query=${encodeURIComponent([b,m,n].filter(Boolean).join(' '))}`,'_blank');};
    </script>
</body>
</html>
